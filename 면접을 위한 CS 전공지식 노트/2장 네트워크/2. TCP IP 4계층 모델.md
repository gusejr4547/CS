# TCP/IP 4계층 모델

## 1. 계층 구조
TCP/IP 계층은 4개의 계층을 가지고 있으며 OSI 7계층과 많이 비교한다.

### TCP/IP 4계층
- 애플리케이션 계층
  
  FTP/HTTP/SSH/SMTP/DNS

- 전송 계층
  
  TCP/UDP/QUIC

- 인터넷 계층
  
  IP/ARP/ICMP

- 링크 계층
  
  이더넷

### OSI 7계층
- 애플리케이션 계층
- 프레젠테이션 계층
- 세션 계층
- 전송 계층
- 네트워크 계층
- 데이터 링크 계층
- 물리 계층

### 애플리케이션 계층
FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층이다.

> **FTP**
> 
> 장치와 장치 간의 파일을 전송하는데 사용되는 표준 통신 프로토콜
>
> **SSH**
>
> 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜
>
> **HTTP**
>
> 데이터 통신의 기초이자 웹 사이트를 이용하는데 쓰는 프로토콜
>
> **SMTP**
>
> 전자메일을 전송하기 위한 인터넷 표준 통신 프로토콜
>
> **DNS**
>
> 도메인 이름과 IP 주소를 매핑해주는 서버

### 전송 계층
송신자와 수신자를 연결하는 통신 서비스를 제공. 

연결지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공할 수 있으며 애플리케이션과 인터넷 계층 사이의 데이터가 전달될 때 중계 역할을 한다. 대표적으로 TCP와 UDP가 있다.

TCP는 패킷 사이의 순서를 보장한다. 연결지향 프로토콜을 사용해서 연결을 하여 신뢰성을 구축해 수신 여부를 확인하며 '가상회선 패킷 교환 방식'을 사용한다.

UDP는 순서를 보장하지 않는다. 단순히 데이터만 주는 '데이터그램 패킷 교환 방식'을 사용한다.

#### 가상회선 패킷 교환 방식
각 패킷에는 가상회선 식별자가 포함. 모든 패킷을 전송하면 가상회선이 해제. 패킷은 순서대로 도착.

#### 데이터그램 패킷 교환 방식
패킷이 독립적으로 이동. 최적의 경로를 선택. 각 분할된 패킷은 서로 다른 경로로 전송될 수 있다. 도착 순서는 다를 수 있다.

#### TCP 연결 성립 과정
3-way-handshake

1. SYN 단계
   
   클라이언트 -> 서버
2. SYN + ACK 단계
   
   서버 -> 클라이언트
3. ACK 단계
   
   클라이언트 -> 서버

#### TCP 연결 해제 과정
4-way-handshake

1. 클라이언트가 FIN 세그먼트 보냄
2. 서버가 ACK 보냄
3. 서버가 좀 있다 FIN 세그먼트 보냄
4. 클라이언트가 ACK 보내서 서버 closed상태가 됨. 클라이언트는 어느 정도 대기 후 연결이 닫힘.

### 인터넷 계층
장치로 부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다.

IP, ARP, ICMP 등이 있다. 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달한다.

제대로 받았는지에 대해 보장하지 않는다. 비연결형적인 특징.

### 링크 계층
전선, 광섬유, 무선 등으로 실질적인 데이터를 전달.

신호를 주고받는 '규칙'을 정하는 계층.

- 데이터 링크 계층
  '이더넷 프레임' 에러확인, 흐름 제어, 접근 제어


### 계층 간 데이터 송수신 과정
캡슐화 -> 전달 -> 비캡슐화


## 2. PDU
PDU(Protocol Data Unit) 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위.

제어관련 정보들이 포함된 '헤더', 데이터를 의미하는 '페이로드'로 구성.

- **애플리케이션 계층** : 메시지
- **전송 계층** : 세그먼트(TCP), 데이터그램(UDP)
- **인터넷 계층** : 패킷
- **링크 계층** : 프레임(데이터 링크 계층), 비트(물리)